package rules
import net.breezeware.dynamo.drools.kjar.entity.BpPatient
rule "Counter shower 3"
when 
	$bpPatient:BpPatient()
 $alarms : Number(intValue == 3)
              from accumulate( 
              	$t:BpPatient(),
       			init(Integer criticalBpCount= 0;), 
            	action( 
            		for( int i = 0; i < $bpPatient.getBpValueList().size()&&
            			criticalBpCount <=3; i++) { 		
            	if($bpPatient.getBpValueList().get(i).getSystolic() > 120 && 
            					$bpPatient.getBpValueList().get(i).getDiastolic() > 80) {
            						criticalBpCount++;
            						System.out.println();
            						System.out.println(
            				$bpPatient.getBpValueList().get(i).getSystolic()+" "+
            				$bpPatient.getBpValueList().get(i).getDiastolic());
            				System.out.println();
            				}
            			}), 
              	result(new Integer(criticalBpCount))
              	)
then 
		System.out.println("Found the patient with high Bp Reading setting warning message");
		$bpPatient.setWarningMessage("Marked as Bp critical"); 
end


	